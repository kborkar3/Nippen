package com.projectwork.impl;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.sql.DataSource;

import com.iss.ketan.db.SQLBuilderIfc;

public class DatabaseConnectionServiceImpl
{

    protected Connection getConnection() throws SQLException
    {
        Context ctx = null;
        Connection con = null;

        Context initContext;
        try
        {
            initContext = new InitialContext();
            ctx = (Context)initContext.lookup("java:/comp/env");
            DataSource ds = (DataSource)ctx.lookup("jdbc/UCPPool");

            con = ds.getConnection();
        }
        catch (NamingException e)
        {
            e.printStackTrace();
        }

        return con;
    }
    
    
    public synchronized SQLBuilderIfc[] fireSelectSQL(String sql, Class sQLBuilderIfc) throws Exception
    {
     /*sql = removeSemiColonFromSQL(sql);*/
    /* logger.debug("SQL--> " + sql);*/

     ResultSet rs = null;
     Statement stmt = null;
     try
     {
         Connection   con = getConnection();
         stmt = con.createStatement();
      rs = stmt.executeQuery("select * from parameter");
     }
     catch (Exception e)
     {
      e.printStackTrace();
     }

     SQLBuilderIfc[] acceptResult = ((SQLBuilderIfc) sQLBuilderIfc.newInstance()).acceptResult(rs);

     try
     {
      rs.close();
     }
     catch (Exception e)
     {
      /*logger.warn(sql, e);*/
         e.printStackTrace();
     }

     return acceptResult;

    }   
    
    
}
